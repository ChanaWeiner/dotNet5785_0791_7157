<Window x:Class="PL.StudentCall.StudentCallListWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:PL.StudentCall"
        mc:Ignorable="d"
        Title="StudentCall List"
        Width="800"
        Height="640"
        DataContext="{Binding RelativeSource={RelativeSource Mode=Self}}"
        Loaded="Window_Loaded"
        Closed="Window_Closed"
        Background="White">



    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0,0,0,10">
            <Label Content="Search:" VerticalAlignment="Center" FontSize="16" Margin="0,0,10,0"/>
            <ComboBox Width="200" FontSize="16" Height="30" SelectedValue="{Binding SelectedSearchOption}" ItemsSource="{Binding Source={StaticResource CallsFieldsCollectionKey}}" />
            <TextBox Width="200" Height="30" FontSize="16" Text="{Binding SearchValue, UpdateSourceTrigger=PropertyChanged}" />
            <Button Content="Search" Width="100" Height="30" FontSize="16" Margin="10,0,0,0" Click="SearchButton_Click"/>
            <Button Content="Clear" Width="100" Height="30" FontSize="16" Margin="10,0,0,0" Click="ClearButton_Click"/>
        </StackPanel>
        <StackPanel Orientation="Horizontal" Grid.Row="1" Margin="0,0,0,10">
            <Label Content="Sort:" VerticalAlignment="Center" FontSize="16" Margin="0,0,10,0"/>
            <ComboBox Width="200" FontSize="16" Height="30" SelectedValue="{Binding SelectedSortOption}" ItemsSource="{Binding Source={StaticResource CallsFieldsCollectionKey}}" />

            <Button Content="Sort" Width="100" Height="30" FontSize="16" Margin="10,0,0,0" Click="SortButton_Click"/>
            <Button Content="Reset Sort" Width="100" Height="30" FontSize="16" Margin="10,0,0,0" Click="ClearButton_Click"/>
        </StackPanel>

        <!-- DataGrid -->
        <DataGrid Grid.Row="2"
          ItemsSource="{Binding CallsList}"
          SelectedItem="{Binding SelectedCall}"
          AutoGenerateColumns="False"
          CanUserAddRows="False"
          FontSize="16"
          Margin="0"
          MouseDoubleClick="LsvCallsList_MouseDoubleClick"
>
            <DataGrid.Columns>
                <DataGridTextColumn Header="Id" Binding="{Binding CallId}" />
                <DataGridTemplateColumn Header="Status">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Status}"
                       Background="{Binding Status, Converter={StaticResource StatusToColorConverterKey}}"
                       Padding="5"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTextColumn Header="Subject" Binding="{Binding Subject}" />
                <DataGridTextColumn Header="Time Left" Binding="{Binding RemainingTime}" />
                <DataGridTextColumn Header="Treatment Time" Binding="{Binding CompletionTime}" />
                <DataGridTextColumn Header="Last Tutor" Binding="{Binding LastTutorName}" />
                <DataGridTextColumn Header="Assignments" Binding="{Binding TotalAssignments}" />

                <!-- כפתור מחיקה -->
                <DataGridTemplateColumn Header="Delete">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Content="Delete"
                            Click="DeleteCall_Click"
                                  Visibility="{Binding CallId, Converter={StaticResource NoAssignmentsToVisibilityConverterKey}}"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- כפתור ביטול הקצאה -->
                <DataGridTemplateColumn Header="Cancel Assignment">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Content="Cancel"
                            Click="CancelAssignment_Click"         />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>


        <!-- Add Button with style -->
        <Button Grid.Row="3"
                Content="Add"
                Click="ButtonAdd_Click" />
    </Grid>
</Window>
